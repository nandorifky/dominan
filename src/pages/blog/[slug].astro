---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
// RENDER KONTEN (Cara Baru untuk type: 'content')
const { Content } = await post.render();

// Data shortcut
const data = post.data;
const seo = data.seo || {};

// SEO Logic
const pageTitle = seo.metaTitle || data.title;
const pageDesc = seo.metaDescription || data.excerpt;
const shareImage = seo.ogImage || data.coverImage || '/og-default.jpg';
const breadcrumbName = seo.breadcrumbTitle || data.title;
const canonicalURL = seo.canonicalUrl || Astro.url.href;
const isNoIndex = seo.noIndex || false;

// Schema JSON-LD
const schemaOrgJSON = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://dominan.web.id/" },
        { "@type": "ListItem", "position": 2, "name": "Blog", "item": "https://dominan.web.id/blog" },
        { "@type": "ListItem", "position": 3, "name": breadcrumbName, "item": Astro.url.href }
      ]
    },
    {
      "@type": "BlogPosting",
      "headline": pageTitle,
      "image": [new URL(shareImage, Astro.site || 'http://localhost:4321').href],
      "datePublished": new Date(data.publishedDate).toISOString(),
      "description": pageDesc,
      "author": { "@type": "Organization", "name": "Dominan Web" }
    }
  ]
};
---

<Layout title={pageTitle}>
  
  <Fragment slot="head">
    <meta name="description" content={pageDesc} />
    <link rel="canonical" href={canonicalURL} />
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDesc} />
    <meta property="og:image" content={shareImage} />
    
    {isNoIndex && <meta name="robots" content="noindex, nofollow" />}
    <script type="application/ld+json" set:html={JSON.stringify(schemaOrgJSON)} />
  </Fragment>

  <article class="bg-white min-h-screen">
    <header class="py-16 md:py-24 border-b-3 border-dom-black bg-zinc-50 text-center relative overflow-hidden">
        <div class="container mx-auto px-6 max-w-4xl relative z-10">
            <nav class="flex justify-center items-center gap-2 text-xs font-bold uppercase tracking-widest text-gray-500 mb-8">
                <a href="/" class="hover:text-black hover:underline">Home</a>
                <span>/</span>
                <a href="/blog" class="hover:text-black hover:underline">Blog</a>
                <span>/</span>
                 <span class="text-dom-black bg-dom-yellow px-1 border border-black truncate max-w-[200px] md:max-w-none">
                    {breadcrumbName}
                </span>
            </nav>

            <h1 class="text-4xl md:text-6xl font-bold mb-6 uppercase leading-tight text-dom-black">{data.title}</h1>
            
            <div class="flex items-center justify-center gap-4 text-sm font-bold">
               <span class="bg-white px-3 py-1 border-2 border-black shadow-neo-sm">
                 {new Date(data.publishedDate).toLocaleDateString('id-ID', { dateStyle: 'long' })}
               </span>
            </div>
        </div>
    </header>

    {data.coverImage && (
        <div class="container mx-auto px-6 max-w-5xl -mt-12 relative z-20">
            <div class="aspect-video border-3 border-dom-black shadow-neo bg-gray-200">
                <img src={data.coverImage} alt={data.title} class="w-full h-full object-cover" />
            </div>
        </div>
    )}

    <div class="container mx-auto px-6 py-16 max-w-3xl">
        <div class="prose prose-lg prose-headings:font-bold prose-headings:uppercase prose-a:text-dom-black prose-a:decoration-dom-yellow prose-img:border-2 prose-img:border-black max-w-none">
            
            {/* INI BAGIAN KONTEN YANG OTOMATIS DI-RENDER */}
            <Content />

        </div>

        <div class="mt-16 pt-8 border-t-2 border-black border-dashed">
            <div class="bg-dom-black text-white p-8 text-center border-3 border-black shadow-neo">
                <h3 class="text-2xl font-bold uppercase mb-2">Artikel ini bermanfaat?</h3>
                <p class="mb-6 text-gray-300">Konsultasikan website Anda sekarang.</p>
                <button onclick="document.getElementById('contactModal').classList.remove('hidden')" class="bg-dom-yellow text-black px-6 py-3 font-bold border-2 border-transparent hover:bg-white transition-all shadow-[4px_4px_0px_0px_rgba(255,255,255,0.2)] hover:shadow-none hover:translate-y-1">
                    KONSULTASI GRATIS
                </button>
            </div>
        </div>
    </div>
  </article>

</Layout>